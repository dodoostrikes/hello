<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Anon Paste â€¢ Neon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0a0f1f" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body { margin: 0; background: #0a0f1f; font-family: 'Inter', sans-serif; color: #fff; }
    .container { max-width: 800px; margin: auto; padding: 20px; }
    h1 { text-align: center; color: #0ff; text-shadow: 0 0 10px #0ff; }
    textarea { width: 100%; height: 150px; background: #111; border: 2px solid #0ff; border-radius: 12px; color: #0ff; padding: 10px; }
    input, button { margin: 10px 0; padding: 10px; border-radius: 12px; border: 2px solid #0ff; background: #111; color: #0ff; }
    .post { border: 1px solid #0ff; border-radius: 12px; padding: 10px; margin: 10px 0; background: #111; box-shadow: 0 0 10px #0ff; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Anon Paste</h1>
    <div id="authSection">
      <input id="username" placeholder="Enter username" />
      <button onclick="register()">Register</button>
      <button onclick="login()">Login</button>
    </div>
    <div id="pasteSection" style="display:none;">
      <textarea id="content" placeholder="Share your thoughts..."></textarea>
      <button onclick="postPaste()">Post</button>
    </div>
    <div id="feed"></div>
  </div>

<script>
const API_BASE = ''; // set your API base URL, or leave '' for same-origin
let token = null;

async function register(){
  const username = document.getElementById('username').value;
  const res = await fetch(`${API_BASE}/api/register`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({username})
  });
  const data = await res.json();
  if(data.token){
    token=data.token;
    localStorage.setItem('token',token);
    localStorage.setItem('secret',data.secret);
    alert("Your secret is: "+data.secret+"  (save this for login!)");
    document.getElementById('authSection').style.display='none';
    document.getElementById('pasteSection').style.display='block';
    loadFeed();
  } else {
    alert(data.error);
  }
}

async function login(){
  const username = document.getElementById('username').value;
  const secret = prompt("Enter your secret");
  const res = await fetch(`${API_BASE}/api/login`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({username,secret})
  });
  const data = await res.json();
  if(data.token){
    token=data.token;
    localStorage.setItem('token',token);
    document.getElementById('authSection').style.display='none';
    document.getElementById('pasteSection').style.display='block';
    loadFeed();
  } else {
    alert(data.error);
  }
}

async function postPaste(){
  const content=document.getElementById('content').value;
  await fetch(`${API_BASE}/api/pastes`,{
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},
    body:JSON.stringify({content})
  });
  document.getElementById('content').value='';
  loadFeed();
}

async function loadFeed(){
  const res=await fetch(`${API_BASE}/api/pastes`);
  const data=await res.json();
  const feed=document.getElementById('feed');
  feed.innerHTML='';
  data.forEach(p=>{
    const div=document.createElement('div');
    div.className='post';
    div.innerHTML=`<b>${p.username}</b>: ${p.content}<br><small>${new Date(p.created_at*1000).toLocaleString()}</small>`;
    feed.appendChild(div);
  });
}

if(localStorage.getItem('token')){
  token=localStorage.getItem('token');
  document.getElementById('authSection').style.display='none';
  document.getElementById('pasteSection').style.display='block';
  loadFeed();
}
</script>
</body>
</html>
